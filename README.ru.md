<h1 align="center">Laravel MCP Server от OP.GG</h1>

<p align="center">
  Мощный пакет Laravel для создания сервера протокола контекста модели (Model Context Protocol)
</p>

<p align="center">
<a href="https://github.com/opgginc/laravel-mcp-server/actions"><img src="https://github.com/opgginc/laravel-mcp-server/actions/workflows/tests.yml/badge.svg" alt="Статус сборки"></a>
<a href="https://packagist.org/packages/opgginc/laravel-mcp-server"><img src="https://img.shields.io/packagist/dt/opgginc/laravel-mcp-server" alt="Всего загрузок"></a>
<a href="https://packagist.org/packages/opgginc/laravel-mcp-server"><img src="https://img.shields.io/packagist/v/opgginc/laravel-mcp-server" alt="Последняя стабильная версия"></a>
<a href="https://packagist.org/packages/opgginc/laravel-mcp-server"><img src="https://img.shields.io/packagist/l/opgginc/laravel-mcp-server" alt="Лицензия"></a>
</p>

<p align="center">
<a href="https://op.gg/open-source/laravel-mcp-server">Официальный сайт</a>
</p>

<p align="center">
  <a href="README.md">English</a> |
  <a href="README.pt-BR.md">Português do Brasil</a> |
  <a href="README.ko.md">한국어</a> |
  <a href="README.ru.md">Русский</a> |
  <a href="README.zh-CN.md">简体中文</a> |
  <a href="README.zh-TW.md">繁體中文</a> |
  <a href="README.pl.md">Polski</a>
</p>

## Обзор

Laravel MCP Server — крутой пакет для лёгкого создания MCP серверов в приложениях на Laravel. **В отличие от других MCP пакетов для Laravel, которые используют stdio**, этот пакет **работает через SSE**, что даёт больше безопасности и контроля.

### Почему SSE а не STDIO?

Stdio прост и популярен в MCP реализациях, но для бизнес-среды он несёт серьёзные риски:

- **Безопасность**: STDIO может слить внутренние детали системы и спецификации API
- **Защита данных**: Компаниям нужно защищать свои API и внутреннюю архитектуру
- **Контроль**: SSE даёт лучший контроль над общением между LLM клиентами и вашим приложением

Используя SSE для MCP сервера, вы можете:

- Открыть только нужные инструменты, оставив детали API в тайне
- Лучше контролировать аутентификацию и авторизацию

Что это даёт:

- Быстрое внедрение SSE в существующие проекты на Laravel
- Работа с новыми версиями Laravel и PHP
- Эффективный обмен данными в реальном времени
- Усиленная безопасность для бизнес-приложений

## Основные функции

- Поддержка коммуникации в реальном времени через интеграцию событий, отправляемых сервером (SSE)
- Реализация инструментов и ресурсов в соответствии со спецификациями протокола контекста модели
- Адаптерная архитектура проектирования с шаблоном обмена сообщениями Pub/Sub (начиная с Redis, планируются другие адаптеры)
- Простая настройка маршрутизации и промежуточного программного обеспечения

## Требования

- PHP >=8.2
- Laravel >=10.x

## Установка

1. Установите пакет через Composer:

   ```bash
   composer require opgginc/laravel-mcp-server
   ```

2. Опубликуйте файл конфигурации:
   ```bash
   php artisan vendor:publish --provider="OPGG\LaravelMcpServer\LaravelMcpServerServiceProvider"
   ```

## Базовое использование

### Создание и добавление пользовательских инструментов

Пакет предоставляет удобные команды Artisan для генерации новых инструментов:

```bash
php artisan make:mcp-tool MyCustomTool
```

Эта команда:

- Обрабатывает различные форматы ввода (пробелы, дефисы, смешанный регистр)
- Автоматически преобразует имя в правильный формат регистра
- Создаёт правильно структурированный класс инструмента в `app/MCP/Tools`
- Предлагает автоматически зарегистрировать инструмент в вашей конфигурации

Вы также можете вручную создавать и регистрировать инструменты в `config/mcp-server.php`:

```php
use OPGG\LaravelMcpServer\Services\ToolService\ToolInterface;

class MyCustomTool implements ToolInterface
{
    // Реализация инструмента
}
```

### Тестирование инструментов MCP

Пакет включает специальную команду для тестирования ваших инструментов MCP без необходимости в реальном клиенте MCP:

```bash
# Интерактивное тестирование конкретного инструмента
php artisan mcp:test-tool MyCustomTool

# Список всех доступных инструментов
php artisan mcp:test-tool --list

# Тестирование с заданными JSON-данными
php artisan mcp:test-tool MyCustomTool --input='{"param":"значение"}'
```

Это помогает быстро разрабатывать и отлаживать инструменты:

- Показывая схему ввода инструмента и валидируя входные данные
- Выполняя инструмент с предоставленными вами входными данными
- Отображая форматированные результаты или подробную информацию об ошибках
- Поддерживая сложные типы входных данных, включая объекты и массивы

### Визуализация инструментов MCP с помощью Инспектора

Вы также можете использовать Model Context Protocol Inspector для визуализации и тестирования ваших инструментов MCP:

```bash
# Запустить MCP Inspector без установки
npx @modelcontextprotocol/inspector node build/index.js
```

Это обычно открывает веб-интерфейс на `localhost:6274`. Чтобы протестировать ваш MCP сервер:

1. Запустите сервер разработки Laravel (например, `php artisan serve`)
2. В интерфейсе Инспектора введите URL SSE вашего Laravel сервера (например, `http://localhost:8000/mcp/sse`)
3. Подключитесь и исследуйте доступные инструменты визуально

URL SSE следует шаблону: `http://[ваш-laravel-сервер]/[default_path]/sse`, где `default_path` определен в вашем файле `config/mcp-server.php`.

## Расширенные возможности

### Архитектура Pub/Sub с адаптерами SSE

Пакет реализует шаблон обмена сообщениями публикация/подписка (pub/sub) через свою систему адаптеров:

1. **Издатель (Сервер)**: Когда клиенты отправляют запросы к конечной точке `/message`, сервер обрабатывает эти запросы и публикует ответы через настроенный адаптер.

2. **Брокер сообщений (Адаптер)**: Адаптер (например, Redis) поддерживает очереди сообщений для каждого клиента, идентифицируемые по уникальным идентификаторам клиентов. Это обеспечивает надёжный асинхронный слой коммуникации.

3. **Подписчик (Соединение SSE)**: Долговременные SSE-соединения подписываются на сообщения для соответствующих клиентов и доставляют их в реальном времени.

Эта архитектура обеспечивает:

- Масштабируемую коммуникацию в реальном времени
- Надёжную доставку сообщений даже при временных разрывах соединения
- Эффективную обработку нескольких одновременных клиентских соединений
- Возможность распределённых серверных развёртываний

### Конфигурация адаптера Redis

Адаптер Redis по умолчанию можно настроить следующим образом:

```php
'sse_adapter' => 'redis',
'adapters' => [
    'redis' => [
        'prefix' => 'mcp_sse_',    // Префикс для ключей Redis
        'connection' => 'default', // Подключение к Redis из database.php
        'ttl' => 100,              // TTL сообщения в секундах
    ],
],
```

## Переменные окружения

Пакет поддерживает следующие переменные окружения для настройки без необходимости изменения файлов конфигурации:

| Переменная | Описание | По умолчанию |
|----------|-------------|--------|
| `MCP_SERVER_ENABLED` | Включение или отключение сервера MCP | `true` |
| `MCP_REDIS_CONNECTION` | Имя подключения Redis из database.php | `default` |

### Пример конфигурации .env

```
# Отключить сервер MCP в определённых средах
MCP_SERVER_ENABLED=false

# Использовать конкретное подключение Redis для MCP
MCP_REDIS_CONNECTION=mcp
```

## Лицензия

Этот проект распространяется под лицензией MIT.
